<?xml      version = "1.0"?>
<!-- Filter title: Global Change Fix:CTO Status Retrieval -->
<!-- 
 ==================================================================
 Global Change Fix: CTO Status Retrieval
 The filter is printing the LeadOrgID, Participating OrgID, and 
 participant status for all participants that list a Clinical Trial
 Office element.
 Output Format:   
   |LeadOrgID;ParticipantOrgID;Status|...
 Sample:
   |CDR0000035883;CDR0000035491#F1;|CDR0000035883;CDR0000029079#F1;Active|
 ================================================================== -->
<xsl:transform               xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                             xmlns:cdr = "cips.nci.nih.gov/cdr"
                               version = "1.0">

 <xsl:output                    method = "text" 
                  omit-xml-declaration = "no"/>

 <!--
 ===================================================================
 Template to change the Organization status.
 =================================================================== -->
 <xsl:template                   match = "/">
   <xsl:apply-templates         select = "InScopeProtocol/ProtocolAdminInfo/
                                          ProtocolLeadOrg/ProtocolSites/
                                          OrgSite/OrgSiteContact/
                                          ClinicalTrialOffice"/>
 </xsl:template>


 <xsl:template                   match = "ClinicalTrialOffice">
  <xsl:if                         test = "position() = 1">
   <xsl:text>|</xsl:text>
  </xsl:if>
  <xsl:value-of                 select = "../../../../
                                          LeadOrganizationID/@cdr:ref"/>
  <xsl:text>;</xsl:text>
  <xsl:value-of                 select = "../../OrgSiteID/@cdr:ref"/>
  <xsl:text>;</xsl:text>
  <xsl:value-of                 select = "../../OrgSiteStatus"/>
  <xsl:text>|</xsl:text>
  <xsl:text>&#xA;</xsl:text>
 </xsl:template>

</xsl:transform>
