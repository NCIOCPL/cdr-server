<?xml version = "1.0" encoding="utf-8"?>
<!-- $Id$ -->
<!-- Filter title: Vendor Filter: Convert CG to Public Data -->
<!--

BZIssue::4675 - Create URLInfo Block
BZIssue::5149 - [Mobile/Deeplinking] Changes to vendor filter to strip out
BZIssue::5274 - Mobile images in Spanish Summaries

==========================================================================
Filter to create Vendor Person XML documents 
========================================================================== -->
  <xsl:transform             xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                               version = "1.0"
                             xmlns:cdr = "cips.nci.nih.gov/cdr" 
               exclude-result-prefixes = "cdr">
    
  <xsl:output                   method = "xml" 
                  omit-xml-declaration = "no"
                              encoding = "utf-8"/>
   
  <xsl:include href = "cdr:name:Module: Global Filter Templates"/>

  <!-- Stylesheet level parameter DateFirstPub, passed in from the caller -->
  <xsl:param                      name = "DateFirstPub"
                                select = "''"/>


<!-- =================================================================
                        Copy control information 
     ================================================================= -->
 <xsl:template                 match = "/">

  <!--
  NOTE:  DO NOT modify the following section!
         This ensures that the DOCTYPE declaration is displayed on a single
         line followed by the root element on it's own line.
  ========================================================================= -->
  <xsl:text  disable-output-escaping = "yes">
&lt;!DOCTYPE </xsl:text>
  <xsl:value-of               select = "name(*)"/>
  <xsl:text  disable-output-escaping = "yes"> &gt;
</xsl:text>
  <!-- 
  End section
  ========================================================================= -->


  <xsl:apply-templates        select = "*" 
                                mode = "copy"/>
 </xsl:template>

 <!--
 Remove various elements from the licensee output
 ======================================================= -->
 <xsl:template                 match = "ArmsOrGroups         |
                                        MobileURL            |
                                        OfficialProtocolTitle|
                                        PermaTargs           |
                                        RegulatoryInformation|
                                        CTGovInterventionType|
                                        UrlInfo"
                                mode = "copy"/>

 <!--
 Remove ProtocolSpecialCategory from CTGovProtocols 
 (but not InScopeProtocols)
 ======================================================= -->
 <xsl:template                 match = "CTGovProtocol/
                                        ProtocolSpecialCategory"
                                mode = "copy"/>

 <!--
 Licensees only receive 'screen' output but no content
 intended for ebook or mobile only.  Therefore, if the
 exclude attribute lists 'screen' we drop the entire section.
 If the attribute lists anything else (mobile, none) we
 will just drop the attribute.
 ======================================================= -->
 <xsl:template                 match = "SummarySection[@ExcludedDevices]"
                                mode = "copy">
  <xsl:choose>
   <xsl:when                    test = "@ExcludedDevices = 'screen'">
    <!-- Do nothing and drop the section -->
   </xsl:when>
   <xsl:otherwise>
    <xsl:copy>
     <xsl:apply-templates     select = "* | @* |
                                        text() |
                                        processing-instruction() |
                                        comment()"
                                mode = "copy"/>
    </xsl:copy>
   </xsl:otherwise>
  </xsl:choose>
 </xsl:template>


 <!--
 Remove the ExcludedDevices attribute
 ======================================================= -->
 <xsl:template                 match = "@ExcludedDevices" mode = "copy"/>

 <!--
 Licensees only receive 'screen' output but no content
 intended for ebook or mobile only.  Therefore, if the
 include attribute lists 'screen' we drop the attribute.
 If the attribute lists anything else (mobile, none) we
 will just drop the entire section.
 ======================================================= -->
 <xsl:template                 match = "SummarySection[@IncludedDevices] |
                                        MediaLink[@IncludedDevices]"
                                mode = "copy">
  <xsl:choose>
   <xsl:when                    test = "@IncludedDevices = 'screen'">
    <xsl:copy>
     <xsl:apply-templates     select = "* | @* |
                                        text() |
                                        processing-instruction() |
                                        comment()"
                                mode = "copy"/>
    </xsl:copy>
   </xsl:when>
   <xsl:otherwise>
    <!-- Do nothing and drop the section -->
   </xsl:otherwise>
  </xsl:choose>
 </xsl:template>

 <!--
 Remove the IncludedDevices attribute
 ======================================================= -->
 <xsl:template                 match = "@IncludedDevices" mode = "copy"/>
</xsl:transform>
