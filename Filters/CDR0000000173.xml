<?xml version="1.0"?>
<xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                 version="1.0"
               xmlns:cdr="cips.nci.nih.gov/cdr">
<xsl:output method="xml" omit-xml-declaration="no"/>

<xsl:template match="Summary">
  <xsl:copy>
     <xsl:apply-templates select="document('cdrutil:/docid')" mode="copy"/>
   <xsl:apply-templates/>
   </xsl:copy>
  </xsl:template>
   <!-- ===============================================
         copy summary meta data, and title 
        ===============================================-->
       <xsl:template match="SummaryMetaData">
   <SummaryMetaData>
      <xsl:apply-templates select="SummaryType" mode="copy"/>
      <xsl:apply-templates select="SummaryAudience" mode="copy"/>
      <xsl:apply-templates select="SummaryLanguage" mode="copy"/>
      
      <xsl:apply-templates select="MainTopics" mode="copy"/>
      <xsl:apply-templates select="SecondaryTopics" mode="copy"/>
   
   </SummaryMetaData>
   </xsl:template>

   <xsl:template match="SummaryTitle">
   <xsl:apply-templates select="." mode="copy"/>
   </xsl:template>
   <!-- =====================================================================
         copy summary sections and add references at the end of each section 
        ===================================================================== -->
         <xsl:template match="SummarySection">
        
            <SummarySection>
          
            <xsl:apply-templates/>
                
                  
                   
            
             </SummarySection>
            </xsl:template>
  
              <xsl:template match="Para">
             <Para><xsl:apply-templates/></Para> 
              </xsl:template>
  
                <xsl:template match="OrderedList">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>
           
              <xsl:template match="ItemizedList">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>

                <xsl:template match="Table">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>
      

            
                <xsl:template match="KeyPoint">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>

              
             <xsl:template match="SectMetaData">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>
                    

            
              <xsl:template match="Title">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:template>

               <xsl:template match="PdqKey">
               <xsl:apply-templates select="." mode="copy"/>
               </xsl:template>

              <xsl:template match="ReferenceList">
              <ReferenceList>
              <xsl:for-each select="Reference">
              <xsl:apply-templates select="." mode="copy"/>
              </xsl:for-each>
              </ReferenceList>
              </xsl:template>

           <!--   <ReferenceList>
                <xsl:for-each select=".//CitationLink/@cdr:ref | .//ProtocolLink@cdr:ref">
             <xsl:for-each select=".//CitationReference/@cdr:ref">
                    <Reference>
                      <xsl:apply-templates select="." mode="copy"/>
                    </Reference>
                 </xsl:for-each>
               </ReferenceList>
            </SummarySection>
         </xsl:for-each>
      </xsl:copy>   
      </xsl:template>-->

             <xsl:template match="CitationLink">
             <xsl:for-each select="@refidx">
            <refidx><xsl:value-of select="."/></refidx>
             </xsl:for-each>
                   
             </xsl:template>
       
           
      

<!-- =================================================================
      Template rule used to do XML to XML transformations which
      copies any attribute node, or node that is child of of something 
     ==================================================================-->

   <xsl:template match="@*|node()" mode="copy">
     <xsl:copy>
       <xsl:apply-templates select="@*" mode="copy"/>
       <xsl:apply-templates mode="copy"/>
     </xsl:copy> 
   </xsl:template>  

</xsl:transform>
