<?xml version="1.0"?>
<!-- Filter title: Global Change: Manage InScopeProtocol DateLastModified -->

 <!--
 ===========================================================================
 If an InScopeProtocol document has a DateLastModfied element:
    Update it to indicate today's date.
 Else:
    Print a warning message.

                                        Author: Alan Meyer
                                          Date: August 2005
 =========================================================================== -->
<xsl:transform       xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                     xmlns:cdr = "cips.nci.nih.gov/cdr"
                       version = "1.0">

 <xsl:output            method = "xml"/>

 <xsl:param               name = "today"/>

 <xsl:template           match = "/">
   <xsl:if                test = "not(InScopeProtocol/DateLastModified)">
     <xsl:message    terminate = "no">
       <xsl:text>No DateLastModified in document.</xsl:text>
     </xsl:message>
   </xsl:if>

   <xsl:apply-templates/>

 </xsl:template>

 <!--
 ================================================================
 Default rule, copy all document elements to output via recursion
 ================================================================ -->
 <xsl:template           match = "@*|comment()|*|
                                  processing-instruction()|text()">
  <xsl:copy>
   <xsl:apply-templates select = "@*|comment()|*|
                                  processing-instruction()|text()"/>
  </xsl:copy>
 </xsl:template>

 <!--
 ================================================================
 Update DateLastModified to be today's date.
 ================================================================ -->
 <xsl:template           match = "DateLastModified">
   <xsl:element           name = "DateLastModified">
     <xsl:value-of      select = "$today"/>
   </xsl:element>
 </xsl:template>

</xsl:transform>
