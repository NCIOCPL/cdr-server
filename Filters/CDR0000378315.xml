<?xml version="1.0"?>
<!-- 
 ==================================================================

 Global Change: Org Status

 ================================================================== -->
<xsl:transform              xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                            xmlns:cdr = "cips.nci.nih.gov/cdr"
                              version = "1.0">

 <xsl:output                   method = "xml" 
                 omit-xml-declaration = "no"/>

 <!--
 ================================================================
 Passed in by the caller.
 Parameter 1, 2, and 3 are mandatory.
  ================================================================ -->
 <xsl:param                      name = "leadOrgId"/>
 <xsl:param                      name = "partOrgId"/>
 <xsl:param                      name = "partStatus"/>

<!--  Leave this section for testing
 <xsl:param                      name = "leadOrgId" select = "'CDR0000035883'"/>
 <xsl:param                      name = "partOrgId" select = "'CDR0000035491'"/>
 <xsl:param                      name = "partStatus" select = "'XXXClosedXXX'"/>
-->

 <!--
 ===================================================================
 Template to change the Organization status.
 =================================================================== -->
 <xsl:template                  match = "/">
  <xsl:apply-templates/>
 </xsl:template>

 <xsl:template                  match = "OrgSite">
  <xsl:choose>
  <xsl:when                      test = "OrgSiteContact/ClinicalTrialOffice
                                         and
                                         OrgSiteID/@cdr:ref = $partOrgId
                                         and 
                                         not(OrgSiteStatus)
                                         and
                                         ../../LeadOrganizationID/
                                           @cdr:ref = $leadOrgId">
   <xsl:copy>
    <xsl:copy-of               select = "OrgSiteID"/>
    <OrgSiteStatus>
     <xsl:value-of             select = "$partStatus"/>
    </OrgSiteStatus>
    <xsl:copy-of               select = "OrgSiteContact"/>
   </xsl:copy>
  </xsl:when>
  <xsl:otherwise>
   <xsl:copy-of                select = "."/>
  </xsl:otherwise>
 </xsl:choose>
 </xsl:template>


 <!--
 ================================================================
 Default rule, copying back out everything just as we got it.
 ================================================================ -->
 <xsl:template                  match = "@*|comment()|*|
                                         processing-instruction()|text()">
  <xsl:copy>
   <xsl:apply-templates        select = "@*|comment()|*|
                                         processing-instruction()|text()"/>
  </xsl:copy>
 </xsl:template>
</xsl:transform>
