<?xml      version = "1.0"?>
<!-- Filter title: Copy XML for InScopeProtocol Full/Admin -->
<!--
================================================================
$Id$

Filter to prepare InScopeProtocol QC reports.
Written by Volker Englisch, 2004-07-16

================================================================ -->
<xsl:transform               xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                               version = "1.0"
                             xmlns:cdr = "cips.nci.nih.gov/cdr">
     
 <xsl:output                    method = "xml" 
                  omit-xml-declaration = "no"/>

 <xsl:include   href = "cdr:name:Module: Citation Formatting"/>
 
 <!--
 ======================================================================
 Filter to create subset of CDR Protocol XML data for UDB
 Elements copied are limited to elements available in current
 test data. Program will be updated when new test data is 
 available.
 Written by Cheryl Burg 11-5-2001
 Select data elements to be copied and add tags when an incomplete
 node is copied
 ====================================================================== -->
 <xsl:template                   match = "InScopeProtocol | 
                                          ScientificProtocolInfo">
  <xsl:copy>
   <!-- Copy protocol titles-->
   <xsl:apply-templates         select = "ProtocolTitle[@Type='Professional']"
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolTitle[@Type='Original']" 
                                  mode = "copy"/>

   <!--Copy Protocol Identifiers  -->
   <xsl:apply-templates         select = "PdqKey" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "BlockedFromCTGov | CTGovDuplicate"
                                  mode = "copy"/>
   <ProtocolIDs>
    <xsl:apply-templates        select = "ProtocolIDs/PrimaryID" 
                                  mode = "copy"/>
    <xsl:for-each               select = "ProtocolIDs/OtherID">
     <OtherID>
      <xsl:apply-templates      select = "IDType" 
                                  mode = "copy"/>
      <xsl:apply-templates      select = "IDString" 
                                  mode = "copy"/>

      <xsl:apply-templates      select = "Comment" 
                                  mode = "copy"/>
     </OtherID>
    </xsl:for-each>
   </ProtocolIDs>

   <xsl:apply-templates         select = "CTGovOwnershipTransferInfo" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolPhase" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ExpectedEnrollment" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolDesign" 
                                  mode = "copy"/>

   <!-- Copy protocol abstract -->
   <ProtocolAbstract>
    <Professional>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          Objectives" 
                                  mode = "copy"/>
     <Outcomes>
      <xsl:apply-templates      select = "ProtocolAbstract/Professional/
                                          Outcome" 
                                  mode = "copy"/>
     </Outcomes>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          EntryCriteria" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          ProjectedAccrual" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          Outline" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          ArmsOrGroups" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          DoseSchedule" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          EnteredBy" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          EntryDate" 
                                  mode = "copy"/>
     <xsl:apply-templates       select = "ProtocolAbstract/Professional/
                                          Comment" 
                                  mode = "copy"/>
    </Professional>
   </ProtocolAbstract>
   <xsl:apply-templates         select = "ProtocolDetail" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "Eligibility" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolSpecialCategory" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolRelatedLinks" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "PublishedResults">
    <xsl:sort                   select = "Citation/@pubyear"
                                 order = "descending"
                             data-type = "number"/>
    <xsl:sort                   select = "Citation/@authorlist"/>
   </xsl:apply-templates>
   <xsl:apply-templates         select = "RelatedPublications">
    <xsl:sort                   select = "Citation/@pubyear"
                                 order = "descending"
                             data-type = "number"/>
    <xsl:sort                   select = "Citation/@authorlist"/>
   </xsl:apply-templates>


   <!-- Copy protocol titles-->
   <xsl:apply-templates         select = "ProtocolTitle[@Type='Patient']"
                                  mode = "copy"/>

   <!-- Copy protocol abstract-->
   <ProtocolAbstract2>
    <xsl:apply-templates        select = "ProtocolAbstract/Patient" 
                                  mode = "copy"/>
   </ProtocolAbstract2>


   <xsl:apply-templates         select = "FundingInfo" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "FDAINDInfo" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolSources" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolApproval" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "OversightInfo" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolSponsors" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "RegulatoryInformation" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "ProtocolAdminInfo" 
                                  mode = "copy"/> 
   <!-- xsl:apply-templates     select = "ProtocolAdminInfo/ProtocolLeadOrg"
                                  mode = "copy"/ -->
   <xsl:apply-templates         select = "ProtocolProcessingDetails" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "VerificationInfo" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "DateLastModified" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "RelatedDocuments" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "CdrDocCtl" 
                                  mode = "copy"/>
  </xsl:copy>   
 </xsl:template>


 <!--
 ========================================================================
 Template to display the formatted Citation Information
 ======================================================================== -->
 <xsl:template                   match = "PublishedResults |
                                          RelatedPublications">
  <xsl:element                    name = "{name()}">
   <xsl:attribute                 name = "cdr:ref">
    <xsl:value-of               select = "Citation/@cdr:ref"/>
   </xsl:attribute>
   <xsl:apply-templates         select = "Citation"/>
  </xsl:element>
  <xsl:element                    name = "{name()}QC">
   <Citation>
    <xsl:apply-templates        select = "Citation"/>
   </Citation>
   <xsl:apply-templates         select = "CitationSource  |
                                          SourceWebsite   |
                                          EnteredBy       |
                                          EntryDate       |
                                          Comment"
                                  mode = "copy"/>
  </xsl:element>
 </xsl:template>


 <!-- 
 ========================================================================
 Template rule used to do XML to XML transformations which
 copies any attribute node, or node that is child of of something
 ======================================================================== -->
 <xsl:template                   match = "@*|node()"  
                                  mode = "copy">
  <xsl:copy>
   <xsl:apply-templates         select = "@*"
                                  mode = "copy"/>
   <xsl:apply-templates           mode = "copy"/>
  </xsl:copy> 
 </xsl:template>

</xsl:transform>
