<CdrDoc Type='Filter' Id='CDR0000000138'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Vendor Filter: Person</DocTitle>
<ReadyForReview readonly="yes">N</ReadyForReview>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml version="1.0"?>
<!-- ===============================================================
      Filter to create Vendor Person XML documents 
     =============================================================== -->
  <xsl:transform             xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                               version = "1.0"
                             xmlns:cdr = "cips.nci.nih.gov/cdr" 
               exclude-result-prefixes = "cdr">
    
  <xsl:include href = "cdr:name:Module: Global Filter Templates"/>
  <xsl:include href = "cdr:name:Module: Vendor Address Templates"/>
  <xsl:include href = "cdr:name:Module: Vendor Phone Templates"/>
   
   
  <xsl:output                   method = "xml" 
                  omit-xml-declaration = "no" 
                                indent = "yes"/>

  <!-- Stylesheet level parameter DateFirstPub, passed in from the caller -->
  <xsl:param                      name = "DateFirstPub"
                                select = "''"/>
 
 
<!-- =================================================================
                        Copy control information 
     ================================================================= -->

   <xsl:template match="Person">
   <xsl:element name='{name()}'>
   <xsl:for-each               select="DocId">
   <xsl:attribute name="id">
   <xsl:value-of               select="."/>
   </xsl:attribute>
   </xsl:for-each>
    <xsl:if                   test="PdqKey">
    <xsl:attribute name="LegacyPDQID">
    <xsl:value-of              select="PdqKey"/>
    </xsl:attribute>
    </xsl:if>
    <xsl:attribute name="Status">
    <xsl:value-of              select="Status/CurrentStatus"/>
    </xsl:attribute>

 

<!-- ====================================================================
                        Copy name information
     ==================================================================== -->
     <xsl:apply-templates      select = "PersonNameInformation"/>


<!-- ======================================================================
    Copy Professional Information  NOTE: Genetics Professional Details not
    available until Phase II of CDR when code will need to be added to
    include those data elements
    ======================================================================== -->
     <xsl:apply-templates      select = "ProfessionalInformation"/>

<!-- xsl:if                       test="not(ProfessionalInformation='')">
<ProfessionalInformation>
<xsl:if                       test="ProfessionalInformation/PhysicianDetails/
                                    AdministrativeInformation/Directory/
                                    Include='Include'">
<xsl:if                      test="Status/CurrentStatus='Active'">
<xsl:for-each                select="ProfessionalInformation/
                                     PDQBoardMembershipDetails/
                                     PDQEditorialBoard/Organization/
                                     OrganizationName[1]">
<xsl:variable name="Ref"    select="../@cdr:ref"/>
<PDQBoardMembership ref="{$Ref}">
<xsl:value-of                select="."/></PDQBoardMembership>
</xsl:for-each>
<xsl:for-each                select="ProfessionalInformation/
                                     PDQBoardMembershipDetails/
                                     PDQAdvisoryBoard/Organization/
                                     OrganizationName[1]">
<xsl:variable name="Ref"    select="../@cdr:ref"/>
<PDQBoardMembership ref="{$Ref}">
<xsl:value-of                select="."/></PDQBoardMembership>
</xsl:for-each>
 <xsl:for-each                select="ProfessionalInformation/
                                     PDQBoardMembershipDetails/
                                     PDQVoluntaryProtocolReviewBoard/
                                     Organization/
                                     OrganizationName[1]">
<xsl:variable name="Ref"    select="../@cdr:ref"/>
<PDQBoardMembership ref="{$Ref}">
<xsl:value-of                select="."/></PDQBoardMembership>
</xsl:for-each>


<PhysicianDetails>

 <xsl:apply-templates        select="ProfessionalInformation/
                                     PhysicianDetails/
                                     PhysicianSpecialtyInformation"
                                     mode="copy"/ -->
                                                                                 
                                    
                                   
                               
    <!-- =========================================================== 
       Copy Physician Membership Information, Member of Cooperative
       Group, Member of Medical Society
     ================================================================= -->
  <!-- PhysicianMembershipInformation>   
      <xsl:for-each           select="ProfessionalInformation/PhysicianDetails
                                      /PhysicianMembershipInformation/
                                      MemberOfCooperativeGroup/
                                      CooperativeGroup">
  <MemberOfCooperativeGroup>
     <xsl:attribute           name="ref">
      <xsl:value-of           select="Organization/@cdr:ref"/>
      </xsl:attribute>
      <xsl:value-of           select="Organization/OrganizationName"/>
  </MemberOfCooperativeGroup>
  </xsl:for-each -->

<!-- ==================================================================
                  Copy MemberOfMedicalSociety
     ================================================================== -->
      
          <!-- xsl:apply-templates        select="ProfessionalInformation/
                                              PhysicianDetails
                                              /PhysicianMembershipInformation/
                                              MemberOfMedicalSociety" 
                                              mode="copy"/>
        </PhysicianMembershipInformation>
        </PhysicianDetails>  
        </xsl:if>
        </xsl:if>
        </ProfessionalInformation>
        </xsl:if -->

  <!-- 
  =====================================================================
  Copy Contact Information for Private Practice and Home location
  ===================================================================== --> 
   <PersonLocations>
   <xsl:apply-templates         select = "PersonLocations/PrivatePractice/
                                          PrivatePracticeLocation |
                                          PersonLocations/
                                          Home"/>
    
<!-- ================================================================
       Contact Information for Other Practice Locations 
     ================================================================ -->
<xsl:for-each                   select = "PersonLocations/
                                          OtherPracticeLocation">
 <xsl:variable                    name = "ind"     
                                select = "@cdr:id"/>
 <xsl:variable                    name = "Stat"    
                                select = "../../Status/CurrentStatus"/>
 <OtherPracticeLocation             id = "{$ind}" 
                                Status = "{$Stat}">

 <xsl:if                          test = "../../Status/CurrentStatus='Inactive'
                                          or 
                                          @PreviousLocation">
  <xsl:attribute                  name = "Status">
   <xsl:text>Inactive--Contact Information may not be current</xsl:text>
  </xsl:attribute>
 </xsl:if>
 <xsl:if                          test = "@cdr:id = ../CIPSContact">
  <xsl:attribute                  name = "CIPSContact">
   <xsl:value-of                select = "'Y'"/>
  </xsl:attribute>
 </xsl:if>

 <xsl:variable                    name = "orgloc" 
                                select = "OrganizationLocation/
                                          Organization/@cdr:ref"/>
 <xsl:variable                    name = "orgnameloc"       
                                select = "substring-before 
                                           (OrganizationLocation/
                                            Organization/@cdr:ref,'#')"/>
                                                                               
 <xsl:variable                    name = "orgAddressFID"    
                                select = "substring-after
                                           (OrganizationLocation/
                                            Organization/@cdr:ref,'#')"/>

 <PersonOrganizationName           ref = "{$orgnameloc}">
  <xsl:value-of                 select = "OrganizationLocation/
                                          PersonOrganizationName"/>
 </PersonOrganizationName>

 <xsl:apply-templates           select = "PersonTitle" 
                                  mode = "copy"/>

 <PersonOrganizationLocation       ref = "{$orgloc}">
 <xsl:for-each                  select = "OrganizationLocation/
                                          Organization/
                                          OrganizationName">
  <OrganizationName>
   <xsl:value-of                select = "."/>
  </OrganizationName>
 </xsl:for-each>


<xsl:for-each                        select="OrganizationAddressNames/
                                             OrganizationName">
<OrganizationName>
<xsl:apply-templates                 select="."/></OrganizationName>
</xsl:for-each>
 <xsl:call-template                  name="getPostalAddress">
 <xsl:with-param                     name="orgAddressFID"
                                     select="$orgAddressFID"/>
 </xsl:call-template>

  <xsl:call-template                 name="getPersonOrgPhone">
  <xsl:with-param                    name="orgAddressFID"
                                     select="$orgAddressFID"/>
  </xsl:call-template>

  <xsl:call-template                 name="getPersonOrgTollFreePhone">
  <xsl:with-param                    name="orgAddressFID"
                                     select="$orgAddressFID"/>
  </xsl:call-template>

  <xsl:call-template                 name="getPersonOrgEmail">
  <xsl:with-param                    name="orgAddressFID"
                                     select="$orgAddressFID"/>
  </xsl:call-template>

  
   <xsl:call-template               name="getPersonOrgWebSite">
   <xsl:with-param                  name="orgAddressFID"
                                    select="$orgAddressFID"/>
   </xsl:call-template>
</PersonOrganizationLocation>
</OtherPracticeLocation>
</xsl:for-each>
</PersonLocations>           
               

<!-- ===================================================================
            Copy Date First Published and Date Last Modified
     ================================================================== -->
 <xsl:choose>
    <xsl:when                     test = "CdrDocCtl/FirstPub/Date">
      <DateFirstPublished>
      <xsl:value-of               select = "substring-before(CdrDocCtl/
                                            FirstPub/Date,'T')"/>
      </DateFirstPublished>
    </xsl:when>
    <xsl:otherwise>
      <xsl:call-template          name = "getDateFirstPub">
        <xsl:with-param           name = "date"
                                  select = "$DateFirstPub"/>
      </xsl:call-template>    
    </xsl:otherwise>
  </xsl:choose>

   <xsl:if                       test="DateLastModified">
   <xsl:apply-templates          select="DateLastModified" mode="copy"/>
   </xsl:if>
</xsl:element> 
</xsl:template>


 <!-- 
 =======================================================================
 Template for ProfessionalInformation
 ======================================================================= -->
 <xsl:template                 match = "ProfessionalInformation">
  <xsl:if                       test = "PhysicianDetails/
                                        AdministrativeInformation/
                                        Directory/Include = 'Include'">
   <xsl:if                      test = "../Status/CurrentStatus = 'Active'">
    <ProfessionalInformation>
     <xsl:for-each            select = "PDQBoardMembershipDetails/
                                        PDQEditorialBoard/Organization/
                                        OrganizationName[1]">
      <xsl:variable             name = "Ref"    
                              select = "../@cdr:ref"/>
      <PDQBoardMembership        ref = "{$Ref}">
       <xsl:value-of          select = "."/>
      </PDQBoardMembership>
     </xsl:for-each>
     <xsl:for-each            select = "PDQBoardMembershipDetails/
                                        PDQAdvisoryBoard/Organization/
                                        OrganizationName[1]">
      <xsl:variable             name = "Ref"    
                              select = "../@cdr:ref"/>
      <PDQBoardMembership        ref = "{$Ref}">
       <xsl:value-of          select = "."/>
      </PDQBoardMembership>
     </xsl:for-each>
     <xsl:for-each            select = "PDQBoardMembershipDetails/
                                        PDQVoluntaryProtocolReviewBoard/
                                        Organization/
                                        OrganizationName[1]">
      <xsl:variable             name = "Ref"    
                              select = "../@cdr:ref"/>
      <PDQBoardMembership        ref = "{$Ref}">
       <xsl:value-of          select = "."/>
      </PDQBoardMembership>
     </xsl:for-each>

     <PhysicianDetails>
      <xsl:apply-templates    select = "PhysicianDetails/
                                        PhysicianSpecialtyInformation"
                                mode = "copy"/>
                               
    <!-- =========================================================== 
       Copy Physician Membership Information, Member of Cooperative
       Group, Member of Medical Society
     ================================================================= -->
      <PhysicianMembershipInformation>   
       <xsl:for-each          select = "PhysicianDetails/
                                        PhysicianMembershipInformation/
                                        MemberOfCooperativeGroup/
                                        CooperativeGroup">
        <MemberOfCooperativeGroup>
         <xsl:attribute         name = "ref">
          <xsl:value-of       select = "Organization/@cdr:ref"/>
         </xsl:attribute>
         <xsl:value-of        select = "Organization/OrganizationName"/>
        </MemberOfCooperativeGroup>
       </xsl:for-each>

<!-- ==================================================================
                  Copy MemberOfMedicalSociety
     ================================================================== -->
       <xsl:apply-templates   select = "PhysicianDetails/
                                        PhysicianMembershipInformation/
                                        MemberOfMedicalSociety" 
                                mode = "copy"/>
      </PhysicianMembershipInformation>
     </PhysicianDetails>  
    </ProfessionalInformation>
   </xsl:if>
  </xsl:if>
 </xsl:template>

</xsl:transform>
]]>
</CdrDocXml>
</CdrDoc>