<CdrDoc Type='Filter' Id='CDR0000000139'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Vendor Filter: Organization</DocTitle>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml version="1.0"?>

<!-- ================================================================
      Filter to create Organization Vendor XML documents
     ================================================================= -->

  <xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                     version="1.0"
                 xmlns:cdr="cips.nci.nih.gov/cdr">
               <!--  exclude-result-prefixes="cdr">-->
        <xsl:output method="xml" omit-xml-declaration="no"/>
      
<!-- ===================================================================
                  Copy Document ID and set it as an attribute
     ================================================================== -->
   
   
      <xsl:template match="Organization">
      <xsl:copy>
      <xsl:for-each select="DocId">
      <xsl:attribute name="id">
      <xsl:value-of select="."/>
      </xsl:attribute>
      </xsl:for-each>
       <xsl:attribute name="LegacyPDQID">
      <xsl:value-of select="PdqKey"/>
      </xsl:attribute>
 <!-- ===================================================================
         Copy Organization Name Information - Official Name/Name
      =================================================================== -->

   <OrganizationNameInformation>
   <xsl:for-each select="OrganizationNameInformation/OfficialName">
   <OfficialName>
   <Name><xsl:value-of select="Name"/></Name>
   </OfficialName>
   </xsl:for-each>
 
  <!-- ===================================================================
         Copy Organization Name Information -  Short Name
      =================================================================== -->


    <xsl:for-each select="OrganizationNameInformation/ShortName">
      <ShortName>
   <Name><xsl:value-of select="Name"/></Name>
   </ShortName>
   </xsl:for-each>

  <!-- ===================================================================
         Copy Organization Name Information -  Alternate Name
      =================================================================== -->


   <xsl:apply-templates select="OrganizationNameInformation/AlternateName" 
       mode="copy"/>
   </OrganizationNameInformation>

<!-- ==============================================================
      Copy Organization Details- Include in Directory Info
     ============================================================== -->

   <xsl:if test="OrganizationDetails/OrganizationAdministrativeInformation">
   <xsl:for-each select="OrganizationDetails/OrganizationAdministrativeInformation">
   <xsl:variable name="Dir" select="@Directory"/>
   <xsl:if test="IncludeInDirectory='Include'">
   <IncludeInDirectory Directory="{$Dir}"/>
   </xsl:if>
   </xsl:for-each>
   </xsl:if>

  <!-- ====================================================================
      Copy Organization Location Info, Street, City, City Suffix, Political
      SubUnit, Country, Postal Code, PostalCodePosition      
     ===================================================================== -->

   <OrganizationLocations>
   <xsl:for-each select="OrganizationLocations/OrganizationLocation/Location">
   <xsl:variable name="lid" select="@id"/>
  <OrganizationLocation id="{$lid}">
   <xsl:if test="../PreviousLocation">
   <xsl:attribute name="status">
   <xsl:text>Inactive--Contact Information may not be current</xsl:text>
   </xsl:attribute>
   </xsl:if>
   <xsl:if test="../@IncludeParentName">
   <xsl:attribute name="IncludeParentName">
   <xsl:value-of select="../@IncludeParentName"/>
   </xsl:attribute>
   </xsl:if>
   <xsl:if test="../@OrderParentNameFirst">
   <xsl:attribute name="OrderParentNameFirst">
   <xsl:value-of select="../@OrderParentNameFirst"/>
   </xsl:attribute>
   </xsl:if>


    <PostalAddress>
      <xsl:for-each select="PostalAddress/Street">
      <xsl:apply-templates select="." mode="copy"/>
      </xsl:for-each>
 

   <xsl:apply-templates select="PostalAddress/City" mode="copy"/>

   <xsl:apply-templates select="PostalAddress/CitySuffix" mode="copy"/>

<xsl:if test="PoliticalSubUnitRef">
<xsl:variable name="pref" select="PostalAddress/PoliticalSubUnitRef"/>
<PoliticalSubUnitName  ref="{$pref}"><xsl:value-of select="PostalAddress/PoliticalSubUnitFullName"/></PoliticalSubUnitName>
</xsl:if>

<xsl:variable name="cref" select="PostalAddress/CountryRef"/>
<CountryName  ref="{$cref}"><xsl:value-of select="PostalAddress/CountryFullName"/></CountryName>

<xsl:apply-templates select="PostalAddress/PostalCode_ZIP" mode="copy"/>

<xsl:apply-templates select="PostalAddress/PostalCodePosition" mode="copy"/>
</PostalAddress>

<!--    =====================================================================
      Copy Phone,  TollFreePhone, Fax, Email and WebSite
    ===================================================================== -->
<xsl:if test="not(Phone/@Public)">
<xsl:apply-templates select="Phone" mode="copy"/>
</xsl:if>

<xsl:apply-templates select="TollFreePhone" mode="copy"/>

<xsl:if test="not(Email/@Public)">
<xsl:apply-templates select="Email" mode="copy"/>
</xsl:if>

<xsl:if test="WebSite">
<WebSite>
<xsl:attribute name="cdr:xref">
<xsl:value-of select="WebSite@cdr:xref"/>
</xsl:attribute>
</WebSite>
</xsl:if>
</OrganizationLocation>
</xsl:for-each>
</OrganizationLocations>

<!--  =======================================================================
                    Copy Organization Affiliations
    ======================================================================= -->
<xsl:if test="OrganizationAffiliations">
<OrganizationAffiliations>
<xsl:if test="OrganizationAffiliations/MemberOfProfessionalOrganization">
<xsl:apply-templates select="OrganizationAffiliations/MemberOfProfessionalOrganization" mode="copy"/>

<xsl:for-each select="OrganizationAffiliations/MemberOfCooperativeGroups/MainMemberOf/CooperativeGroup">
<xsl:variable name="MID" select="CoopMID"/>
 <MemberOfCooperativeGroup ref="{$MID}" MemberType="Main"><xsl:value-of select="OfficialName/Name"/></MemberOfCooperativeGroup>
</xsl:for-each>
</xsl:if>

<xsl:if test="OrganizationAffiliations/MemberOfCooperativeGroups/AffiliateMemberOf/CooperativeGroup">
<xsl:for-each select="OrganizationAffiliations/MemberOfCooperativeGroups/AffiliateMemberOf/CooperativeGroup">
<xsl:variable name="CID" select="CoopAID"/>
 <MemberOfCooperativeGroup ref="{$CID}" MemberType="Affiliate"><xsl:value-of select="Name"/></MemberOfCooperativeGroup>
</xsl:for-each>
</xsl:if>
</OrganizationAffiliations>
</xsl:if>

 <!-- ====================================================================
                   Copy Organization Type
      ==================================================================== -->
   <xsl:if test="not(OrganizationType/@Public)">
  <xsl:apply-templates select="OrganizationType" mode="copy"/>
   </xsl:if>


</xsl:copy>
</xsl:template>

<!-- =====================================================================
     Template rule to do XML to XML transformation which
     copies any attribute node, or node that is child of of something 
    ===================================================================== -->

   <xsl:template match="@*|node()" mode="copy">
     <xsl:copy>
       <xsl:apply-templates select="@*" mode="copy"/>
       <xsl:apply-templates mode="copy"/>
       </xsl:copy> 
     </xsl:template>

</xsl:transform>]]>
</CdrDocXml>
</CdrDoc>