<CdrDoc Type='Filter' Id='CDR0000000134'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Vendor Filter: Term</DocTitle>
<ReadyForReview readonly="yes">N</ReadyForReview>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml  version = "1.0"?>
<!-- 
===================================================================
Filter to create the vendor Terminology XML 
=================================================================== -->
<xsl:transform               xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                             xmlns:cdr = "cips.nci.nih.gov/cdr"
                               version = "1.0">
    
 <xsl:output                    method = "xml" 
                  omit-xml-declaration = "no"/>

 <xsl:include  href = "cdr:name:Module: Vendor Filter Templates"/>
   
 <!-- Stylesheet level parameter DateFirstPub, passed in from the caller -->
 <xsl:param                       name = "DateFirstPub"
                                select = "''"/> 

 <!-- *
 ====================================================================
 Root element.
 ==================================================================== -->
 <xsl:template                   match = "*">
  <xsl:apply-templates/>
 </xsl:template>


 <!-- 
 ======================================================================
 Copy DocId, PreferredName, OtherTermName, OtherNameType
 ====================================================================== -->
 <xsl:template                   match = "Term">
  <xsl:element                    name = '{name()}'>   
   <xsl:attribute                 name = "id">
    <xsl:value-of               select = "DocId"/>
   </xsl:attribute>
   <xsl:attribute                 name = "LegacyPDQID">
    <xsl:value-of               select = "PdqKey"/>
   </xsl:attribute>

   <xsl:apply-templates         select = "PreferredName" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "OtherName"/>
   <xsl:apply-templates         select = "Definition"/>
   <xsl:apply-templates         select = "TermType/TermTypeName"/>
   <xsl:apply-templates         select = "SemanticType"/>
   <xsl:apply-templates         select = "TermRelationship"/>
   <xsl:apply-templates         select = "MenuInformation"/>
               
   <!-- 
   ===================================================================
   Copy Date First Published and Date Last Modified
   =================================================================== -->
   <xsl:choose>
    <xsl:when                     test = "CdrDocCtl/FirstPub/Date">
     <DateFirstPublished>
      <xsl:value-of             select = "substring-before(CdrDocCtl/
                                            FirstPub/Date,'T')"/>
     </DateFirstPublished>
    </xsl:when>
    <xsl:otherwise>
     <xsl:call-template           name = "getDateFirstPub">
      <xsl:with-param             name = "date"
                                select = "$DateFirstPub"/>
     </xsl:call-template>    
    </xsl:otherwise>
   </xsl:choose>
 
   <xsl:apply-templates         select = "DateLastModified" 
                                  mode = "copy"/>
  </xsl:element>
 </xsl:template>


 <!--
 ===================================================================
 =================================================================== -->
 <xsl:template                   match = "OtherName">
  <OtherName>
   <OtherTermName>
    <xsl:value-of               select = "OtherTermName"/>
   </OtherTermName>
   <OtherNameType>
    <xsl:value-of               select = "OtherNameType"/>
   </OtherNameType>
  </OtherName>
 </xsl:template>


 <!--
 ===================================================================
 =================================================================== -->
 <xsl:template                   match = "Definition">
  <Definition>
   <xsl:apply-templates         select = "DefinitionText" 
                                  mode = "copy"/>
   <DefinitionType>
    <xsl:value-of               select = "DefinitionType"/>
   </DefinitionType>
  </Definition>
 </xsl:template>


 <!--
 ===================================================================
 =================================================================== -->
 <xsl:template                   match = "TermTypeName">
  <xsl:if                         test = ". = 
                                             'Protocol selection criteria' or
                                          . = 
                                             'Obsolete term'               or
                                          . = 
                                             'Header term'                or
                                          . = 
                                             'Semantic type'">

  <TermTypeName>
   <xsl:value-of                select = "."/>
  </TermTypeName>
  </xsl:if>
 </xsl:template>


 <!--
 ===================================================================
 =================================================================== -->
 <xsl:template                   match = "SemanticType">
  <SemanticType>
   <xsl:attribute                 name = "ref">
    <xsl:value-of               select = "Term/@cdr:ref"/>
   </xsl:attribute>
   <xsl:value-of                select = "Term/PreferredName"/>
  </SemanticType>
 </xsl:template>


 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "TermRelationship">
  <TermRelationship>
   <xsl:apply-templates         select = "ParentTerm | RelatedTerm"/>
  </TermRelationship>
 </xsl:template>


 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "ParentTerm">
  <ParentTerm>
   <ParentTermName>
    <xsl:attribute                name = "ref">
     <xsl:value-of              select = "TermId/Term/@cdr:ref"/>
    </xsl:attribute>
    <xsl:value-of               select = "TermId/Term/PreferredName"/>
   </ParentTermName>
 
   <xsl:apply-templates         select = "ParentType" 
                                  mode = "copy"/>
  </ParentTerm>
 </xsl:template>


 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "RelatedTerm">
  <RelatedTerm>
   <RelatedTermName>
    <xsl:attribute                name = "ref">
     <xsl:value-of              select = "TermId/Term/@cdr:ref"/>
    </xsl:attribute>
    <xsl:value-of               select = "TermId/Term/PreferredName"/>
   </RelatedTermName>
   <xsl:apply-templates         select = "RelationshipType" 
                                  mode = "copy"/>
  </RelatedTerm>
 </xsl:template>


 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "MenuInformation">
  <MenuInformation>
   <xsl:apply-templates         select = "MenuItem"/>
  </MenuInformation>
 </xsl:template>

 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "MenuItem">
  <MenuItem>
   <xsl:if                        test = "@SortOrder">
    <xsl:attribute                name = "SortOrder">
     <xsl:value-of              select = "@SortOrder"/>
    </xsl:attribute>
   </xsl:if>

   <xsl:apply-templates         select = "MenuType" 
                                  mode = "copy"/>
   <xsl:apply-templates         select = "MenuParent"/>
   <xsl:apply-templates         select = "DisplayName" 
                                  mode = "copy"/>
  </MenuItem>
 </xsl:template>

 <!--
 ===================================================================
 Copy Term Relationship (Parent TermId,PreferredName,ParentType
 =================================================================== -->
 <xsl:template                   match = "MenuParent">
  <MenuParent>
   <xsl:attribute name = "ref">
    <xsl:value-of select = "Term/@cdr:ref"/>
   </xsl:attribute>

   <xsl:apply-templates select = "Term/PreferredName"/>
  </MenuParent>
 </xsl:template>
</xsl:transform>
]]>
</CdrDocXml>
</CdrDoc>