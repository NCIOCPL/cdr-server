<CdrDoc Type='Filter' Id='CDR0000000159'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Summary-Copy XML for Patient Summary Report</DocTitle>
<ReadyForReview readonly="yes">N</ReadyForReview>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml version="1.0"?>
<xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
               version="1.0"
               xmlns:cdr="cips.nci.nih.gov/cdr">
<xsl:output method="xml" omit-xml-declaration="no"/>
<!--Filter written by C.Burg/N.Gottlieb - 5/6/2002, modified 1/2003 -->

<xsl:template match="Summary">
   <xsl:copy>
   <!--==========================
      only do Patient Summaries
      ==========================-->
      <xsl:if test="SummaryMetaData/SummaryAudience='Patients'">

    <!--==================================
       copy summary meta data, and title
      ================================== -->

      <SummaryMetaData>
         <xsl:apply-templates         select="SummaryMetaData/SummaryType"   
                                       mode="copy"/>
         <xsl:apply-templates         select="SummaryMetaData/SummaryAudience" 
                                       mode="copy"/>
         <xsl:apply-templates         select="SummaryMetadata/SummaryLanguage" 
                                       mode="copy"/>
      </SummaryMetaData>

      <xsl:apply-templates            select="SummaryTitle" mode="copy"/>

      <xsl:for-each                   select="SummarySection"> 
          
   
      <!--=================================
          copy keypoints for keypoints box
          =================================-->

      <xsl:apply-templates       select="Title" mode="copy"/>
      <KeyPoints>
      <KeyPointsList Style='bullet'>
      <xsl:for-each              select="SummarySection">
       <xsl:if test="KeyPoint">
       <ListItem>
       <xsl:apply-templates      select="KeyPoint" mode="copy"/>
       
     <xsl:for-each               select="SummarySection">
       <xsl:apply-templates      select="Title" mode="copy"/>     
       <xsl:if test="KeyPoint">
       <KeyPointsList Style='dash'>
      <ListItem>
      <xsl:apply-templates       select="KeyPoint" mode="copy"/>
      </ListItem>
       </KeyPointsList>
      </xsl:if>
      </xsl:for-each>
      </ListItem>
      </xsl:if>
      </xsl:for-each> 
      </KeyPointsList>
      </KeyPoints>
      
         
           
     <!--============================================================
         copy summary sections and add references at the end of each 
         section 
         ============================================================-->
       <xsl:apply-templates        select="." mode="copy"/>
       <xsl:apply-templates        select="PdqKey" mode="copy"/>
       </xsl:for-each>
        <GlossaryTerms>
        <xsl:for-each               select="//GlossaryTermRef">
        <GlossaryTerm>
       <GlossaryTermRef>
       <xsl:value-of               select="."/>
       </GlossaryTermRef>
       
       <xsl:variable name="defID"  select="@cdr:href"/>
      
      <xsl:variable name="defInfo" select="document(concat('cdr:',$defID,'/last'))"/>
       <TermName>
       <xsl:value-of               select="$defInfo/GlossaryTerm/
                                            TermName"/> 
       </TermName>
       <TermDefinition>     
       <xsl:value-of               select="$defInfo/GlossaryTerm/
                                            TermDefinition"/>
       </TermDefinition>
       </GlossaryTerm>
       </xsl:for-each>
       </GlossaryTerms>
       </xsl:if>
       </xsl:copy>  
       </xsl:template>

    

       
<!-- ================================================================
     Template rule used to do XML to XML transformations which
     copies any attribute node, or node that is child of of something
     ================================================================ -->

   <xsl:template match="@*|node()" mode="copy">
     <xsl:copy>
       <xsl:apply-templates select="@*" mode="copy"/>
       <xsl:apply-templates mode="copy"/>
     </xsl:copy> 
   </xsl:template>  


</xsl:transform>]]>
</CdrDocXml>
</CdrDoc>