<CdrDoc Type='Filter' Id='CDR0000000042'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Denormalization Filter (1/5): Summary</DocTitle>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml version="1.0"?>

<!-- =====================================================================
      Filter to create XML data for Hp summary to add references to end of
      each summary section 
     ======================================================================-->
<!-- Written by Cheryl Burg 7-24-2001 -->
<!-- ======================================================================
      Select data elements to be copied and add tags when an incomplete
      node is copied 
     ======================================================================-->
<!-- ======================================================================
      This filter copies the citation links in the summary sections to the
      end of each section
     ======================================================================-->
<xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                 version="1.0"
               xmlns:cdr="cips.nci.nih.gov/cdr">
<xsl:output method="xml" omit-xml-declaration="no"/>

<xsl:template match="Summary">
  <xsl:copy>
     <xsl:apply-templates select="document('cdrutil:/docid')" mode="copy"/>

   <!-- ===============================================
         copy summary meta data, and title 
        ===============================================-->
   <SummaryMetaData>
      <xsl:apply-templates select="SummaryMetaData/SummaryType" mode="copy"/>
      <xsl:apply-templates select="SummaryMetaData/SummaryAudience" mode="copy"/>
      <xsl:apply-templates select="SummaryMetaData/SummaryLanguage" mode="copy"/>
      <xsl:apply-templates select="SummaryMetaData/PDQBoard" mode="copy"/>
      <xsl:apply-templates select="SummaryMetaData/MainTopics" mode="copy"/>
      <xsl:apply-templates select="SummaryMetaData/SecondaryTopics" mode="copy"/>
   
   </SummaryMetaData>

   <xsl:apply-templates select="SummaryTitle" mode="copy"/>
   <!-- =====================================================================
         copy summary sections and add references at the end of each section 
        =====================================================================-->
         <xsl:for-each select="SummarySection">
         <xsl:variable name="ID" select="@cdr:id"/>
            <SummarySection cdr:id="{$ID}">
               <xsl:apply-templates select="SectMetaData" mode="copy"/>
               <xsl:apply-templates select="KeyPoint" mode="copy"/>
               <xsl:apply-templates select="Title" mode="copy"/>
              <xsl:apply-templates select="Para | OrderedList |ItemizedList | SummarySection | Table"  mode="copy"/>
                           
               <xsl:apply-templates select="PdqKey" mode="copy"/>
               <ReferenceList>
                 <xsl:for-each select=".//CitationLink/@cdr:ref | .//ProtocolLink@cdr:ref">
                <Reference>
                <xsl:apply-templates select="." mode="copy"/>
               </Reference>
               </xsl:for-each>
               </ReferenceList>
               </SummarySection>
               </xsl:for-each>
               <xsl:apply-templates select="DateLastModified" mode="copy"/>
               <xsl:apply-templates select="PatientVersionOf" mode="copy"/>
               <xsl:apply-templates select="PdqKey" mode="copy"/>
               </xsl:copy>   
               </xsl:template>

<!-- =================================================================
      Template rule used to do XML to XML transformations which
      copies any attribute node, or node that is child of of something 
     ==================================================================-->

   <xsl:template match="@*|node()" mode="copy">
     <xsl:copy>
       <xsl:apply-templates select="@*" mode="copy"/>
       <xsl:apply-templates mode="copy"/>
     </xsl:copy> 
   </xsl:template>  

</xsl:transform>]]>
</CdrDocXml>
</CdrDoc>