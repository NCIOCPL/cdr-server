<CdrDoc Type='Filter' Id='CDR0000331662'>
<CdrDocCtl>
<DocValStatus readonly="yes">U</DocValStatus>
<DocActiveStatus readonly="yes">A</DocActiveStatus>
<DocTitle readonly="yes">Module: Citation Denormalization</DocTitle>
<DocComment>Restored after refresh of CDR database on Mahler</DocComment><ReadyForReview readonly="yes">N</ReadyForReview>
</CdrDocCtl>
<CdrDocXml><![CDATA[<?xml version="1.0"?>
<!--
     Module: Citation Denormalization
     Creator:  Volker Englisch
     Created:  08/12/2003
-->

<xsl:transform               xmlns:xsl = "http://www.w3.org/1999/XSL/Transform"
                             xmlns:cdr = "cips.nci.nih.gov/cdr"
                               version = "1.0">

 <xsl:output                    method = "xml" 
                  omit-xml-declaration = "no"
                              encoding = "UTF-8"/>


 <!-- *
 ==============================================================
 Template Published Results section
 ============================================================== -->
 <xsl:template                  match = "Citation | CitationLink">
  <Citation>
   <xsl:for-each               select = "@*">
    <xsl:attribute                name = "{name()}">
     <xsl:value-of              select = "."/>
    </xsl:attribute>
   </xsl:for-each>

   <xsl:variable                 name = "citRef"
                               select = "@cdr:ref"/>
   <xsl:variable                 name = "citInfo" 
                               select = "document(concat('cdr:', $citRef,
                                                            '/lastp'))"/>
   <!-- 
   This new attribute is introduced in order to sort by publication
   year across different citation types
   ================================================================ -->
   <xsl:attribute                name = "pubyear">
    <xsl:value-of              select = "$citInfo/Citation/PDQCitation/
                                         PublicationDetails/
                                         PublicationYear      |
                                         $citInfo/Citation/PubmedArticle//
                                         PubDate/Year"/>
   </xsl:attribute>

   <xsl:apply-templates        select = "$citInfo/Citation/PDQCitation | 
                                         $citInfo/Citation/PubmedArticle"/>

  </Citation>
 </xsl:template>



 <!-- *
 ==============================================================
 Template PublishedIn section
 ============================================================== -->
 <xsl:template                  match = "PublishedIn">
  <xsl:element                   name = "{name()}">
   <xsl:for-each               select = "@*">
    <xsl:attribute               name = "{name()}">
     <xsl:value-of             select = "."/>
    </xsl:attribute>
   </xsl:for-each>

   <xsl:variable                 name = "citRef"
                               select = "@cdr:ref"/>
   <xsl:variable                 name = "citInfo" 
                               select = "document(concat('cdr:', $citRef,
                                                            '/lastp'))"/>
   <xsl:copy-of                select = "$citInfo/Citation"/>

  </xsl:element>
 </xsl:template>

</xsl:transform>
]]>
</CdrDocXml>
</CdrDoc>